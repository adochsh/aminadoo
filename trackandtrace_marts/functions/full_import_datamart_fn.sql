--liquibase formatted sql
--changeset 60067166:create:trackandtrace_marts.full_import_datamart_fn

CREATE OR REPLACE FUNCTION full_import_datamart_fn()
    RETURNS boolean
    LANGUAGE plpgsql
AS $function$
begin
    truncate table full_import_datamart;
    insert into full_import_datamart (supplier_mode,
                                      direction,
                                      order_id,
                                      order_date,
                                      adeo_order_id,
                                      oc_or_pi_number,
                                      oc_or_pi_date,
                                      adeo_code,
                                      lm_code,
                                      ean_code,
                                      lm_name_ru,
                                      lm_name_eng,
                                      status_global,
                                      rms_order_status,
                                      eta_wh_calc,
                                      second_acceptance_wh_plan,
                                      eta_wh_calc_ym,
                                      eta_wh_calc_yw,
                                      dep_code,
                                      dep_name,
                                      dep,
                                      sub_dep_code,
                                      sub_dep_name,
                                      sub_dep,
                                      supplier_code,
                                      supplier_name,
                                      supplier,
                                      country,
                                      flow_type,
                                      top_1000,
                                      mdd,
                                      brand,
                                      best_price,
                                      gamma,
                                      priority,
                                      loc,
                                      order_qty,
                                      shipped_qty,
                                      received_qty,
                                      remain_to_ship_qty,
                                      dpac_item,
                                      received_dpac_amount,
                                      remain_dpac_amount,
                                      item_amount,
                                      order_amount,
                                      incoterms,
                                      season_validity_date_from,
                                      season_validity_date_to,
                                      supplier_contract_number,
                                      supplier_contract_date,
                                      payment_date,
                                      status_kalypso,
                                      adeo_dep_name,
                                      bu_name,
                                      swb,
                                      transport,
                                      invoice_status,
                                      invoice_number,
                                      invoice_date,
                                      actual_container,
                                      actual_number_original,
                                      container_number1,
                                      container_number2,
                                      modified_container,
                                      container_type,
                                      container_type_1st_leg,
                                      container_type_2nd_leg,
                                      loading_type,
                                      loading_type_1st_leg,
                                      loading_type_2nd_leg,
                                      delivery_unit_volume,
                                      delivery_unit_ordered_unit_code,
                                      forwarder_id,
                                      main_transport_company_id,
                                      pol,
                                      pod,
                                      destination_rail_station,
                                      wh,
                                      etd_oc,
                                      eta_oc,
                                      ship_release_date,
                                      ship_deadline,
                                      truck_arr_pol_fact,
                                      etd_pol_plan,
                                      etd_confirmed,
                                      rdd_pol,
                                      eta_confirmed,
                                      etd_pod_updated,
                                      etd_pod_plan_fwr,
                                      eta_pod_plan,
                                      rta_pod,
                                      transport_from_pod,
                                      custom_in_plan,
                                      custom_in_fact,
                                      etd_pod_plan,
                                      rdd_pod,
                                      rta_rail_station,
                                      rdd_rail_station,
                                      arrival_wh_plan,
                                      arrival_wh_fact,
                                      drop_off,
                                      receiving_date1,
                                      receiving_date2,
                                      forwarder_comments,
                                      tu,
                                      release_to,
                                      release_to_modified,
                                      loading_percent,
                                      customs_terminal,
                                      customs_broker,
                                      comments_broker,
                                      fwr_appl_create_date,
                                      fwr_appl_confirm_date,
                                      invoice_total_volume,
                                      invoice_qty,
                                      invoice_qty_pkgs,
                                      invoice_price,
                                      invoice_curr,
                                      invoice_total_amount,
                                      invoice_net_weight,
                                      invoice_gross_weight,
                                      invoice_pallets,
                                      letter_of_credit,
                                      comments_kalypso,
                                      cd_number,
                                      cd_proc,
                                      cd_date,
                                      cd_status,
                                      cd_status_date,
                                      cd_out,
                                      cd_decision,
                                      cd_decision_date,
                                      cd_decision_time,
                                      cd_modified_date,
                                      cd_modified_time,
                                      cd_good_id,
                                      cn_code,
                                      invoice_hs_code,
                                      cd_good_status,
                                      cd_good_status_date,
                                      cd_good_status_time,
                                      cd_good_desc,
                                      container_capacity,
                                      good_net_weight,
                                      good_gross_weight,
                                      cd_customs_type,
                                      accrual_basis_payment,
                                      customs_rate,
                                      customs_tax,
                                      cd_consignment_info,
                                      cd_consignment_id,
                                      cd_consignment_date,
                                      cd_airbill_info,
                                      cd_airbill_id,
                                      cd_airbill_date,
                                      cd_railbill_info,
                                      cd_railbill_id,
                                      cd_railbill_date,
                                      cd_trnsprtbill_info,
                                      cd_trnsprtbill_id,
                                      cd_trnsprtbill_date,
                                      cd_another_trnsprtbill_info,
                                      cd_another_trnsprtbill_id,
                                      cd_another_trnsprtbill_date,
                                      cd_doc_info,
                                      cd_doc_id,
                                      cd_doc_issuedate,
                                      cd_lm_qty,
                                      cd_good_unit_type,
                                      cd_lm_desc,
                                      cd_lm_manufacturer,
                                      under_certification,
                                      doc_type,
                                      tech_regulation,
                                      doc_serial_id,
                                      doc_serial_issue,
                                      doc_serial_expiry,
                                      doc_serial_valid,
                                      doc_batch_id,
                                      doc_batch_issue,
                                      gln,
                                      manufacturer_address,
                                      production_site_address,
                                      samples_required,
                                      samples_qty,
                                      samples_pi_id,
                                      initial_pi_sending_date,
                                      deadline_pi_sending_date,
                                      sample_sending_way,
                                      sample_sending_date,
                                      awb_or_container_samples_id,
                                      deadline_sample_sending_date,
                                      reason_sample_sending_late,
                                      oc_status,
                                      arf_status,
                                      pi_sample_status,
                                      current_order_task,
                                      doc_conformity_status,
                                      doc_ship_status,
                                      doc_set_status,
                                      status_oc,
                                      status_invoice,
                                      import_specialist,
                                      appro_specialist,
                                      cd_specialist,
                                      certification_specialist,
                                      custom_in_calc,
                                      prod_kpi,
                                      prod_deviation,
                                      ship_kpi,
                                      ship_deviation,
                                      pod_arr_kpi,
                                      pod_arr_deviation,
                                      custom_in_kpi,
                                      custom_in_delay_days,
                                      cd_request_kpi,
                                      cd_request_delay,
                                      custom_out_kpi,
                                      custom_out_delay_days,
                                      sample_sending_kpi,
                                      sample_sending_delay,
                                      arrival_wh_kpi,
                                      arrival_wh_deviation,
                                      second_acceptance_kpi,
                                      second_acceptance_delay,
                                      eta_wh_kpi,
                                      eta_wh_deviation,
                                      route_id,
                                      samples_sent_code,
                                      samples_required_code,
                                      calculated_etd,
                                      comments_for_etd,
                                      transport_instruction,
                                      dbf_base_ries_invoices,
                                      dbf_customs_declaration,
                                      dbf_customs_declaration_items,
                                      dbf_kalypso_containers,
                                      dbf_ries_orders,
                                      dbf_ries_shipment_tracking,
                                      dbf_rms_item_info,
                                      dbf_rms_orders,
                                      dbf_rms_orders_shipments)

    select supplier_mode,
           direction,
           order_id,
           order_date,
           adeo_order_id,
           oc_number,
           oc_date,
           adeo_code,
           lm_code,
           ean_code,
           lm_name_ru,
           lm_name_eng,
           status_global,
           rms_order_status,
           eta_wh_calc,
           second_acceptance_wh_plan,
           eta_wh_calc_ym,
           eta_wh_calc_yw,
           dep_code,
           dep_name,
           dep,
           sub_dep_code,
           sub_dep_name,
           sub_dep,
           supplier_code,
           supplier_name,
           supplier,
           country,
           flow_type,
           top_1000,
           mdd,
           brand,
           best_price,
           gamma,
           priority,
           loc,
           order_qty,
           shipped_qty,
           received_qty,
           remain_to_ship_qty,
           dpac_item,
           received_dpac_amount,
           remain_dpac_amount,
           item_amount,
           order_amount,
           incoterms,
           season_validity_date_from,
           season_validity_date_to,
           supplier_contract_number,
           supplier_contract_date,
           payment_date,
           status_kalypso,
           adeo_dep_name,
           bu_name,
           swb,
           transport,
           invoice_status,
           invoice_number,
           invoice_date,
           actual_container,
           actual_number_original,
           container_number1,
           container_number2,
           modified_container,
           container_type,
           container_type_1st_leg,
           container_type_2nd_leg,
           loading_type,
           loading_type_1st_leg,
           loading_type_2nd_leg,
           delivery_unit_volume,
           delivery_unit_ordered_unit_code,
           forwarder_id,
           main_transport_company_id,
           pol,
           pod,
           destination_rail_station,
           wh,
           etd_oc,
           eta_oc,
           ship_release_date,
           ship_deadline,
           truck_arr_pol_fact,
           etd_pol_plan,
           etd_confirmed,
           rdd_pol,
           eta_confirmed,
           etd_pod_updated,
           etd_pod_plan_fwr,
           eta_pod_plan,
           rta_pod,
           transport_from_pod,
           custom_in_plan,
           custom_in_fact,
           etd_pod_plan,
           rdd_pod,
           rta_rail_station,
           rdd_rail_station,
           arrival_wh_plan,
           arrival_wh_fact,
           drop_off,
           receiving_date1,
           receiving_date2,
           forwarder_comments,
           tu,
           release_to,
           release_to_modified,
           loading_percent,
           customs_terminal,
           customs_broker,
           comments_broker,
           fwr_appl_create_date,
           fwr_appl_confirm_date,
           cast (invoice_total_volume as text),
           invoice_qty,
           invoice_qty_pkgs,
           invoice_price,
           invoice_curr,
           invoice_total_amount,
           invoice_net_weight,
           invoice_gross_weight,
           invoice_pallets,
           letter_of_credit,
           comments_kalypso,
           cd_number,
           cd_proc,
           cd_date,
           cd_status,
           cd_status_date,
           cd_out,
           cd_decision,
           cd_decision_date,
           cd_decision_time,
           cd_modified_date,
           cd_modified_time,
           cd_good_id,
           cn_code,
           invoice_hs_code,
           cd_good_status,
           cd_good_status_date,
           cd_good_status_time,
           cd_good_desc,
           container_capacity,
           good_net_weight,
           good_gross_weight,
           cd_customs_type,
           accrual_basis_payment,
           customs_rate,
           customs_tax,
           cd_consignment_info,
           cd_consignment_id,
           cd_consignment_date,
           cd_airbill_info,
           cd_airbill_id,
           cd_airbill_date,
           cd_railbill_info,
           cd_railbill_id,
           cd_railbill_date,
           cd_trnsprtbill_info,
           cd_trnsprtbill_id,
           cd_trnsprtbill_date,
           cd_another_trnsprtbill_info,
           cd_another_trnsprtbill_id,
           cd_another_trnsprtbill_date,
           cd_doc_info,
           cd_doc_id,
           cd_doc_issuedate,
           cd_lm_qty,
           cd_good_unit_type,
           cd_lm_desc,
           cd_lm_manufacturer,
           under_certification,
           doc_type,
           tech_regulation,
           doc_serial_id,
           doc_serial_issue,
           doc_serial_expiry,
           doc_serial_valid,
           doc_batch_id,
           doc_batch_issue,
           gln,
           manufacturer_address,
           production_site_address,
           samples_required,
           samples_qty,
           samples_pi_id,
           initial_pi_sending_date,
           deadline_pi_sending_date,
           sample_sending_way,
           sample_sending_date,
           awb_or_container_samples_id,
           deadline_sample_sending_date,
           reason_sample_sending_late,
           oc_status,
           arf_status,
           pi_sample_status,
           current_order_task,
           doc_conformity_status,
           doc_ship_status,
           doc_set_status,
           status_oc,
           status_invoice,
           import_specialist,
           appro_specialist,
           cd_specialist,
           certification_specialist,
           custom_in_calc,
           prod_kpi,
           prod_deviation,
           ship_kpi,
           ship_deviation,
           pod_arr_kpi,
           pod_arr_deviation,
           custom_in_kpi,
           custom_in_delay_days,
           cd_request_kpi,
           cd_request_delay,
           custom_out_kpi,
           custom_out_delay_days,
           sample_sending_kpi,
           sample_sending_delay,
           arrival_wh_kpi,
           arrival_wh_deviation,
           second_acceptance_kpi,
           second_acceptance_delay,
           eta_wh_kpi,
           eta_wh_deviation,
           route_id,
           samples_sent_code,
           samples_required_code,
           calculated_etd,
           comments_for_etd,
           transport_instruction,
           dbf_base_ries_invoices,
           dbf_customs_declaration,
           dbf_customs_declaration_items,
           dbf_kalypso_containers,
           dbf_ries_orders,
           dbf_ries_shipment_tracking,
           dbf_rms_item_info,
           dbf_rms_orders,
           dbf_rms_orders_shipments
    FROM v_import_datamart_v2
    UNION
    SELECT supplier_mode,
           direction,
           order_id,
           order_date,
           adeo_order_id,
           pi_number,
           pi_date,
           adeo_code,
           lm_code,
           ean_code,
           lm_name_ru,
           lm_name_eng,
           status_global,
           rms_order_status,
           eta_wh_calc,
           second_acceptance_wh_plan,
           eta_wh_calc_ym,
           eta_wh_calc_yw,
           dep_code,
           dep_name,
           dep,
           sub_dep_code,
           sub_dep_name,
           sub_dep,
           supplier_code,
           supplier_name,
           supplier,
           country,
           flow_type,
           top_1000,
           mdd,
           brand,
           best_price,
           gamma,
           priority,
           loc,
           order_qty,
           shipped_qty,
           received_qty,
           remain_to_ship_qty,
           dpac_item,
           received_dpac_amount,
           remain_dpac_amount,
           item_amount,
           order_amount,
           incoterms,
           season_validity_date_from,
           season_validity_date_to,
           supplier_contract_number,
           supplier_contract_date,
           payment_date,
           status_kalypso,
           adeo_dep_name,
           bu_name,
           swb,
           transport,
           invoice_status,
           invoice_number,
           invoice_date,
           actual_container,
           null as actual_number_original,
           container_number1,
           container_number2,
           modified_container,
           container_type,
           container_type_1st_leg,
           container_type_2nd_leg,
           loading_type,
           loading_type_1st_leg,
           loading_type_2nd_leg,
           delivery_unit_volume,
           delivery_unit_ordered_unit_code,
           forwarder_id,
           main_transport_company_id,
           pol,
           pod,
           destination_rail_station,
           wh,
           etd_oc,
           eta_oc,
           ship_release_date,
           ship_deadline,
           truck_arr_pol_fact,
           etd_pol_plan,
           etd_confirmed,
           rdd_pol,
           eta_confirmed,
           etd_pod_updated,
           etd_pod_plan_fwr,
           eta_pod_plan,
           rta_pod,
           transport_from_pod,
           custom_in_plan,
           custom_in_fact,
           etd_pod_plan,
           rdd_pod,
           rta_rail_station,
           rdd_rail_station,
           arrival_wh_plan,
           arrival_wh_fact,
           drop_off,
           receiving_date1,
           receiving_date2,
           forwarder_comments,
           tu,
           release_to,
           release_to_modified,
           loading_percent,
           customs_terminal,
           customs_broker,
           comments_broker,
           fwr_appl_create_date,
           fwr_appl_confirm_date,
           invoice_total_volume,
           invoice_qty,
           invoice_qty_pkgs,
           invoice_price,
           invoice_curr,
           invoice_total_amount,
           invoice_net_weight,
           invoice_gross_weight,
           invoice_pallets,
           letter_of_credit,
           comments_kalypso,
           cd_number,
           cd_proc,
           cd_date,
           cd_status,
           cd_status_date,
           cd_out,
           cd_decision,
           cd_decision_date,
           cd_decision_time,
           cd_modified_date,
           cd_modified_time,
           cd_good_id,
           cn_code,
           invoice_hs_code,
           cd_good_status,
           cd_good_status_date,
           cd_good_status_time,
           cd_good_desc,
           container_capacity,
           good_net_weight,
           good_gross_weight,
           cd_customs_type,
           accrual_basis_payment,
           customs_rate,
           customs_tax,
           null as cd_consignment_info,
           cd_consignment_id,
           cd_consignment_date,
           null as cd_airbill_info,
           cd_airbill_id,
           cd_airbill_date,
           null as cd_railbill_info,
           cd_railbill_id,
           cd_railbill_date,
           null as cd_trnsprtbill_info,
           cd_trnsprtbill_id,
           cd_trnsprtbill_date,
           null as cd_another_trnsprtbill_info,
           cd_another_trnsprtbill_id,
           cd_another_trnsprtbill_date,
           null as cd_doc_info,
           null as cd_doc_id,
           null as cd_doc_issuedate,
           cd_lm_qty,
           cd_good_unit_type,
           cd_lm_desc,
           cd_lm_manufacturer,
           under_certification,
           doc_type,
           tech_regulation,
           doc_serial_id,
           doc_serial_issue,
           doc_serial_expiry,
           doc_serial_valid,
           doc_batch_id,
           doc_batch_issue,
           gln,
           manufacturer_address,
           production_site_address,
           samples_required,
           samples_qty,
           samples_pi_id,
           initial_pi_sending_date,
           deadline_pi_sending_date,
           sample_sending_way,
           sample_sending_date,
           awb_or_container_samples_id,
           deadline_sample_sending_date,
           reason_sample_sending_late,
           oc_status,
           arf_status,
           pi_sample_status,
           current_order_task,
           doc_conformity_status,
           doc_ship_status,
           doc_set_status,
           status_oc,
           status_invoice,
           import_specialist,
           appro_specialist,
           cd_specialist,
           certification_specialist,
           custom_in_calc,
           prod_kpi,
           prod_deviation,
           ship_kpi,
           ship_deviation,
           pod_arr_kpi,
           pod_arr_deviation,
           custom_in_kpi,
           custom_in_delay_days,
           cd_request_kpi,
           cd_request_delay,
           custom_out_kpi,
           custom_out_delay_days,
           sample_sending_kpi,
           sample_sending_delay,
           arrival_wh_kpi,
           arrival_wh_deviation,
           second_acceptance_kpi,
           second_acceptance_delay,
           eta_wh_kpi,
           eta_wh_deviation,
           null as route_id,
           null samples_sent_code,
           null samples_required_code,
           null calculated_etd,
           null comments_for_etd,
           null transport_instruction,
           null as dbf_base_ries_invoices,
           null as dbf_customs_declaration,
           null as dbf_customs_declaration_items,
           null as dbf_kalypso_containers,
           null as dbf_ries_orders,
           null as dbf_ries_shipment_tracking,
           null as dbf_rms_item_info,
           null as dbf_rms_orders,
           null as dbf_rms_orders_shipments
    FROM v_direct_mode_datamart
    ;

    return 0;
end;

$function$
;
